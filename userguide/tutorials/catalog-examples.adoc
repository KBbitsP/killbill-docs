= Catalog Examples

This document provides some catalog examples and how they affect the invoicing and subscriptions.

== Usage Modes

TODO

== Single Plan with Multiple Phases

As explained in the https://docs.killbill.io/latest/userguide_subscription.html#_plans[subscription billing] document, each plan consists of phases which can be one of the type TRIAL, DISCOUNT, FIXEDTERM, EVERGREEN.

This section provides examples of catalogs that consist of a single plan with multiple phases.

=== No Trial and Fixed Term

This example uses the  https://github.com/killbill/killbill-docs/blob/1a945188c0ef53a3c7f797b4890514d35c09c46f/catalogs/fixedterm-no-trial.xml[Fixed Term No Trial] catalog. In this case, there is only a single FIXEDTERM phase for a period of six weeks with a weekly recurring charge of $24.95

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a subscription on 2021-09-10   |Invoice generated for $24.95 
|Trigger invoice dry run with target date 2021-09-18    |Invoice generated for  $24.95 for 2021-09-17 to 2021-09-24  
|Trigger invoice dry run with target date 2022-10-15    |Invoice generated for  $24.95 for 2021-10-15 to 2021-10-22   
|Trigger invoice dry run with target date 2021-10-29    |No invoice generated as fixed term is over.  
|===


=== No trial and monthly evergreen phase

This example uses the  https://github.com/killbill/killbill-docs/blob/1a945188c0ef53a3c7f797b4890514d35c09c46f/catalogs/monthly-no-trial.xml[Monthly No Trail] catalog. In this case, there is a single EVERGREEN phase with a monthly recurring charge of $24.95

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a subscription on 2021-09-10   |Invoice generated for $24.95 
|Trigger invoice dry run with target date 2021-10-12    |Invoice generated for  $24.95 for 2021-10-10 to 2021-11-10  
|Trigger invoice dry run with target date 2021-12-10    |Invoice generated for  $24.95 for 2021-12-10 to 2022-01-10   
|Trigger invoice dry run with target date 2022-05-18    |Invoice generated for  $24.95 for 2022-05-10 to 2022-06-10 
|===


=== Trial and monthly evergreen phase

This example uses the  https://github.com/killbill/killbill-docs/blob/1a945188c0ef53a3c7f797b4890514d35c09c46f/catalogs/monthly-with-trial.xml[Monthly With Trail] catalog. In this case, there is a TRIAL phase of 10 days followed by an EVERGREEN phase with a monthly recurring charge of $24.95

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a subscription on 2021-09-10   |Invoice generated for $0 due to trial phase
|Trigger invoice dry run with target date 2021-09-20    |Trial phase ends so Invoice generated for  $24.95 for 2021-09-20 to 2021-10-20  
|Trigger invoice dry run with target date 2021-10-20    |Invoice generated for  $24.95 for 2021-10-20 to 2022-11-20   
|Trigger invoice dry run with target date 2022-02-17    |Invoice generated for  $24.95 for 2022-01-20 to 2022-02-20 
|===


=== Monthly with Fixed and Recurring Price


This example uses the  https://github.com/killbill/killbill-docs/blob/1a945188c0ef53a3c7f797b4890514d35c09c46f/catalogs/monthly-with-fixed-and-recurring[Monthly With Fixed And Recurring Price] catalog. In this case, there is a single EVERGREEN PHASE. It has a fixed price of $50 and a monthly recurring charge of $24.95.

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a subscription on 2021-09-13   |Invoice generated for $74.95 (Fixed price as well as recurring price)
|Trigger invoice dry run with target date 2021-10-13    |Invoice generated for $24.95 (only recurring price) for 2021-10-13 to 2021-11-13  
|===

=== Discount and Monthly evergreen phase

This example uses the  https://github.com/killbill/killbill-docs/blob/1a945188c0ef53a3c7f797b4890514d35c09c46f/catalogs/monthly-with-discount-and-evergreen.xml[Monthly With Discount and Evergreen] catalog. In this case, there is a DISCOUNT phase of 3 months (with a monthly charge of $4.95) followed by an EVERGREEN phase with a monthly recurring charge of $24.95.

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a subscription on 2021-09-15   |Invoice generated for $4.95 due to DISCOUNT phase
|Trigger invoice dry run with target date 2021-10-15    |Invoice generated for  $4.95 for 2021-10-15 to 2021-11-15  
|Trigger invoice dry run with target date 2021-12-15    |Discount phase ends, Invoice generated for  $24.95 for 2021-12-15 to 2022-01-15   
|===


== Multiple Plans

A catalog can contain multiple plans corresponding to different products. Further, a catalog can also include plans corresponding to add-on products. 

Subscriptions can be created for each plan within a catalog. Further, each subscription can be created on a different date. This section examines the effect of creating multiple subscriptions on different dates on the invoices generated.

This section uses the  https://github.com/killbill/killbill-docs/blob/1a945188c0ef53a3c7f797b4890514d35c09c46f/catalogs/monthly-with-trial-and-discount.xml[Monthly No Trail With Addon] catalog. In this case, there are two products:

[options="header",cols="1,1"]
|===
|Product   |Category   
//-------------
|Standard   |Base   
|RemoteControl   |Add_on   
|===

It has the following plans:

[options="header",cols="1,1,1"]
|===
|Plan Name   |Product|Plan Description
//----------------------
|standard_monthly   |Standard   |Single EVERGREEN phase with a monthly recurring charge of $24.95   
|remotecontrol-monthly   |RemoteControl   |Single EVERGREEN phase with a monthly recurring charge of $17.95    
 
|===

=== Base subscription and add on on same day

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a subscription on 2021-09-15   |Invoice generated for $24.95 
|Trigger invoice dry run with target date 2021-10-15    |Invoice generated for $24.95 for 2021-10-15 to 2021-11-15  
|Add add-on (remotecontrol-monthly) to subscription on 2021-09-15 |Invoice generated for $17.95 
|Trigger invoice dry run with target date 2021-10-15    |Invoice generated with two invoice items for $42.90. Both items have date 2021-10-15 to 2021-11-15  
|===

=== Addon subscription created on a different date

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a subscription on 2021-09-15   |Invoice generated for $24.95 
|Trigger invoice dry run with target date 2021-10-15    |Invoice generated for $24.95 for 2021-10-15 to 2021-11-15  
|Add add-on (remotecontrol-monthly) to subscription with date 2021-09-30 |No invoice generated
|Trigger invoice dry run with target date 2021-09-30    |Invoice generated for $8.98 for 2021-09-30 to 2021-10-15
|Trigger invoice dry run with target date 2021-10-15    |Invoice generated with two invoice items for $42.90. Both items have date 2021-10-15 to 2021-11-15    
|===


=== Monthly and Annual Plan??

== Billing Alignment Rules

Another important section in the catalog is the https://docs.killbill.io/latest/userguide_subscription.html#_billing_alignment_rules[Billing Alignment Rules] section. Quick summary about the Billing alignment rules:

* The Billing Alignment Rules section specifies whether the user will be billed at the account level, subscription level or subscription bundle level. 
* If the catalog specifies ACCOUNT level billing alignment, all the subscriptions belonging to the account are aligned and invoiced with the Bill Cycle Day (BCD) specified while creating an account. 
* If the catalog specifies SUBSCRIPTION billing alignment, each subscription will be invoiced as per its creation date.
* If the catalog specifies BUNDLE billing alignment, all the subscriptions are aligned and invoiced on the same day.

Let us now take a look at a few catalogs and examples.

=== Catalog with ACCOUNT billing alignment

When ACCOUNT billing alignment is specified in the catalog, the billing cycle of all the subscriptions are aligned with the BCD of the account. Note that this is the default billing alignment, so even when billing alignment rules are not explicitly specified in a catalog, it defaults to ACCOUNT.

This example uses the  https://github.com/killbill/killbill-docs/blob/1a945188c0ef53a3c7f797b4890514d35c09c46f/catalogs/monthly-no-trial-account-billing-alignment.xml[Monthly No Trial with Account Billing Alignment] catalog. In this case, ACCOUNT billing alignment is specified.

==== Case 1: Account with no BCD

If no BCD is specified with the account, it defaults to the first recurring bill date of the first subscription.

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a new account. Leave BCD field empty  |Account created
|Create a subscription on 2021-09-16   |Invoice generated for $24.95. BCD set to 16
|Trigger invoice dry run with target date 2021-10-16   |Invoice generated for $24.95 for 2021-10-16 to 2021-11-16  
|===

==== Case 2: Account with BCD

If a BCD is specified with the account, the subscriptions are invoiced on the specified day. If the start date of a subscription is different from the BCD, the first invoice will be prorated.


[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a new account. Specify BCD as 25 |Account created with BCD set to 25
|Create a subscription on 2021-09-16   |Invoice generated for $7.24 (prorated from 2021-09-16 to 2021-09-25)
|Trigger invoice dry run with target date 2021-09-25   |Invoice generated for $24.95 for 2021-09-25 to 2021-10-25  
|===


=== Case 2: Account with no BCD different subscription date



TODO

=== Catalog with ACCOUNT billing alignment (Multiple subscriptions)

When there are multiple subscriptions associated with an account, all the subscriptions are aligned with the BCD.

This example uses the  https://github.com/killbill/killbill-docs/blob/1a945188c0ef53a3c7f797b4890514d35c09c46f/catalogs/monthly-and-annual-plan.xml[Monthly and Annual Plan] catalog. In this case, ACCOUNT billing alignment is specified. It has two plans as follows:

It has the following plans:

[options="header",cols="1,1,1"]
|===
|Plan Name   |Product|Plan Description
//----------------------
|standard_monthly   |Standard   |Single EVERGREEN phase with a monthly recurring charge of $24.95   
|standard_annual  |Standard   |Single EVERGREEN phase with an annual recurring charge of $275  
 
|===

==== Case 1: Account with no BCD

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a new account. Leave BCD field empty  |Account created
|Create a subscription for the standard-monthly plan on 2021-09-16   |Invoice generated for $24.95. BCD set to 16
|Trigger invoice dry run with target date 2021-10-16   |Invoice generated for standard-monthly plan $24.95 for 2021-10-16 to 2021-11-16  
|Create a subscription for the standard-annual plan on 2021-09-16   |Invoice generated for $275. 
|Trigger invoice dry run with target date 2021-10-16   |Invoice generated for standard-monthly plan for $24.95 for 2021-10-16 to 2021-11-16  
|Trigger invoice dry run with target date 2022-09-16   |Invoice generated with two invoice items corresponding to both plans for $299.95. 
|===

==== Case 2: Account with BCD

[options="header",cols="1,1"]
|===
|Action   |Result   
//-------------
|Create a new account. Specify BCD as 25 |Account created with BCD set to 25
|Create a subscription for the standard-monthly plan on 2021-09-16   |Invoice generated for $7.24 (prorated from 2021-09-16 to 2021-09-25)
|Trigger invoice dry run with target date 2021-09-25   |Invoice generated for standard-monthly plan for $24.95 for 2021-09-25 to 2021-10-25   
|Create a subscription for the standard-annual plan on 2021-09-16   |Invoice generated for $6.78 (prorated from 2021-09-16 to 2021-09-25). 
|Trigger invoice dry run with target date 2021-09-25   |Invoice generated with two invoice items corresponding to both plans for $299.95 
|Trigger invoice dry run with target date 2021-10-25   |Invoice generated for standard-monthly plan for $24.95 for 2021-10-25 to 2021-11-25   
|Trigger invoice dry run with target date 2022-09-25   |Invoice generated with two invoice items corresponding to both plans for $299.95
|===

==== Case 3: Account with no BCD, subscriptions on different days

TODO

=== Catalog with SUBSCRIPTION billing alignment

=== Catalog with BUNDLE billing alignment

=== Catalog with a combination of billing alignment rules



== Subscription Alignment Rules

== Catalog Versions

== Catalog Effective Date






