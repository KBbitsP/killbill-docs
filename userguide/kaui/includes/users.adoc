:imagesdir: C:\_My Documents\FlowWritingLLC\Projects\Kill Bill\Documentation\killbill-docs\userguide\assets\img\kaui

//Formal location - https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/kaui

// /admin_allowed_users

//Mary's directory - C:\_My Documents\FlowWritingLLC\Projects\Kill Bill\Documentation\killbill-docs\userguide\assets\img\kaui

This section explains how to manage users in Kaui:

* Creating and editing user profiles
* Assigning roles to users
* Adding new roles (if necessary)
* Definining which tenants the user can access (multi-tenancy only)  {MAY NOT COVER THIS HERE}

This section assumes that you can log in as a Kaui admin (who has all permissions) or as a user with the associated permissions for working with users, roles, and permissions.

== Overview

"Users" refers to those who log in to Kaui to perform actions (add a charge, generate a dry-run invoice, etc.).

In order for users to work in Kaui, you need to create a user profile for each one. The user profile defines the username/password and at least one _role_.

If you are managing users with a third-party system, all that's required in Kaui is to add the username per the <<Add a User>> section.

If you are managing users with the Kill Bill database, first create the user with <<Add a User>>, then add passwords and roles by following the <<Edit a User>> steps.

==== About User Roles

The role(s) assigned to a user define what tasks the user can perform in the system (for example, perform a chargeback or add a custom field).

SOMETHING about tenant here, but I'm currently confused where that's defined. A user profile with its defined roles/permissions applies only to the tenant ... ???

// ADD "Permissions" and "Role" to Glossary
// Permissions - A list of operations that can be performed in the system.

=== Users and Tenant Access

FIGURE THIS OUT:
See Tenants and Admin section?

Kaui needs to be told about the relationship between user and tenants (this mapping is specific to the UI). The idea, is that a super admin would first configure the allowed users for each specific tenant on the KAUI side, in such a way that later on, when a specific user logs in, he only sees the tenants he has access to.

This mapping can be configured by going to each user page (e.g. /admin_allowed_users/1).

QSTS:
- How do I get access to the screen that lets you map users to tenants
- Where can I see a list of existing user roles for the tenant
- As mary@kill-bill.org user, do I need more permissions to see the gears icon at the top of the screen? Or can I access with those specific URL addresses (like /admin_allowed_users/1)?
- Can you delete users from Kaui, or do you have to remove them on the Kill Bill side (or in the 3rd party system)?

== Before You Begin

If your organization uses a third-party tool (such as LDAP, Okta, or Auth0) to manage Kill Bill users and roles, before adding Kaui users, you must first configure them in the third-party system. For more information, see https://docs.killbill.io/latest/user_management.html[Users, Roles, and Permissions Management].

If you are using the Kill Bill database to store user data, adding a user profile to in Kaui automatically creates it in Kill Bill.

== Create a New User Role

Add new role: https://demo.killbill.io/role_definitions/new


[NOTE]
*Note:* Currently, you cannot list or update roles in Kaui.

== Add a User

. Click on your username and tenant name in the upper right corner:
+
image::Users-SelectTenantName.png[width=650,align="center"]
+
. In the center of the screen, next to "Allowed Users," click the plus icon ( image:i_PlusGreen.png[] ).
+
Kaui displays the Add Allowed User pop-up:
+
image::AddAllowedUser.png[width=350,align="center"]
+
. Fill in the *User Name* field.
. Click the *Add* button. If successful, Kaui displays the new user in the list of Allowed Users:
+
^^I COULD USE A SCREENSHOT OF A LONGER LIST THAN THIS. I CAN BLUR OUT EMAIL ADDRESSES.
+
. If you are delegating roles and users management to a third-party system, you must now define the user's password and role(s) in that system.
+
OR
+
If you are using the Kill Bill database to store user data, continue to <<Edit a User>> to set the user's password, role, and other information.

== Edit a User

To edit a user:

. Click on your username and tenant name in the upper right corner:
+
image::Users-SelectTenantName.png[width=650,align="center"]
+
. In the list of Allowed Users, click on the user to edit:
+
image::AllowedUsersList.png[width=650,align="center"]
+
^^SAME COMMENT AS ABOVE ABOUT NEEDING A SCREENSHOT WITH A LONGER USER LIST
+
Kaui displays the User Details screen.
+
image::UserDetails.png[width=450,align="center"]
+
. Click *Edit* (next to "User Details").
+
Kaui displays the Update User screen:
+
image::UpdateUser.png[width=450,align="center"]
+
. Fill in the user fields. For field descriptions, see <<Add New User Field Descriptions>>.
. Click the *Save* button.

== Add New User Field Descriptions

[cols="1,3"]
|===
^|Field ^|Description

| Managed externally (LDAP, Okta, etc.)?
| Check this box if you are managing users in a third-party system. Otherwise, leave it empty.

| Name
| Enter the user's name _QST: Name should be first, last, both? Is email address here optional?_

| Password
| Enter the user's password. It may be easier to copy and paste the password into this field.

| Description
| If you want a brief description of this user or his/her role, type it here. Kaui displays it in the Allowed Users list.

| Roles
| ... To create a new role, see <<Create a New Role>>.

|LDAP, Okta, and Auth0

|===

== Change a User's Password

== Delete a User



== Resources

* https://killbill.io/blog/multi-tenancy-authorization/[Multi-Tenancy and Authorization]

https://github.com/killbill/killbill-api/blob/master/src/main/java/org/killbill/billing/security/Permission.java


ORIGINAL KAUI MAT'L:

The management of the users that can access the api along with their roles and associated permissions is managed by Kill Bill server through the shiro layer. Such users must be configured on the server side in order to be available from KAUI and the assumption here is that those already exists on the server side. Please refer to our user management guide.

KAUI contains a default admin user (and by default Kill Bill also contains such an admin user with its associated password password, which has the root role containing all permissions). This allows to login to KAUI and bootstrap the KAUI configuration (without having to run manual SQL by hand for instance).

The first stage is to login using the default admin user:

SCREENSHOT

When login-in, KAUI will check whether some tenants have been configured for this user:

If no tenant current exist for this user, you will be prompted to add a new tenant (next section)

If only one tenant exists for this user, KAUI will automatically select that tenant as the default tenant

If only more than one tenant exists for this user, KAUI will prompt for a tenant to chose (note that cross tenant operations such as adding new users or tenants can still happen as long as the user has the priviledges to do so).

Upon login success one will see the following screen:

SCREENSHOT

Assuming now, we have another user demo already configured on the server side, and we want to make it available in KAUI. The previous screenshot shows the menu USERS that allows to add new users known to KAUI. By clicking on that link, one will see the existing users known to KAUI and by clicking on the + button, will have the option to add a new user. Letâ€™s make the demo user known to KAUI:

SCREENSHOT

Upon success, one will see the following screen, and will be able to select the existing tenant(s) that this user can manage:

SCREENSHOT
