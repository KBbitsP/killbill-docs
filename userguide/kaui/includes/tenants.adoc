:icons: font
:imagesdir: C:\_My Documents\FlowWritingLLC\Projects\Kill Bill\Documentation\killbill-docs\userguide\assets\img\kaui


=== Overview

For each Kill Bill deployment, you can run multiple tenants. A few examples of running different tenants for your organization incude:

* Software development environments (coding, testing, production, etc.)
* Product lines (brick-and-mortar, online ecommerce, etc.)
* Regions (north, southeast, central, etc.)

[IMPORTANT]
*Important:* If you have already created tenants using the API, you must also add them in Kaui in order for Kaui to recognize them.

=== Additional Resources

* https://killbill.github.io/slate/#tenant[Tenant API]
* https://killbill.io/blog/multi-tenancy-authorization/[Multi-Tenancy and Authorization]
* https://docs.killbill.io/latest/userguide_configuration.html#_per_tenant_properties[Per Tenant Properties]

=== Create a Tenant

The _first time_ that you login after installing Kaui, you will see the Add New Tenant screen. Start at step 3 below.

To create _additional_ tenants, follow the steps below.

. At the top of the screen, click the gears icon ( image:i_gears.png[] ) and select *Tenants*.
+
image::Homepage-SelectGears.png[width=650,align="center"]
+
Kaui displays a list of tenants on the Tenants screen:
+
image::TenantsList.png[width=850,align="center"]
+
. Click the plus sign ( image:i_PlusGreen.png[] ) next to *Kaui Tenants*.
+
Kaui displays the Add New Tenant screen:
+
image::AddNewTenant.png[width=450,align="center"]
+
. Enter the tenant *Name*, *API Key*, and *API Secret*.
+
[NOTE]
 *Note:* The API key and API secret pair are used in all HTTP requests to ensure that the user issuing the request has the correct permissions to access the tenant.
+
. Click the *Save* button.
+
Kaui displays the Tenant Configuration page with the new tenant name in the upper right corner:
+
image::TenantConfig-TenantName.png[width=850,align="center"]

=== Tenant Configuration Page

This section explains the main areas of the Tenant Configuration page.

image::TenantConfig-Labeled.png[width=850,align="center"]

*1 Tenant Details*

This read-only area displays basic information about the tenant.

*2 Useful Links*

Click on a link to go to the associated list.

*3 Allowed Users*

This section displays the users who have permission to log on to this tenant. You can click on the user name to view that users's details or click on the plus sign ( image:i_PlusGreen.png[] ) to add a new user for the current tenant.

By default, the admin user has access to the tenant.

To add a user from this screen, see <<Add an Allowed User to the Tenant>>. For more information, see the <<users-roles-and-permissions, Users, Roles, and Permissions>> chapter.

*4 Tenant Configuration Tabs*

The tabs at the bottom of the Tenant Configuration page allow you upload various files that are specific to the current tenant:

* <<Catalog Show Tab>>—Create and manage catalog XML files.

* *Overdue Show*—Create and manage the XML configuration file that helps to control Kill Bill's overdue (dunning) functionality.

* *Invoice Template*—Upload invoice template files.

* *Invoice Translation*—Upload translated invoice files.

* *Catalog Translation*—Upload translated catalog strings files.

* *Plugin Config*—Upload plugin configuration files.

=== Add an Allowed User to the Tenant

The steps below explain how to add an _existing_ user to the current tenant. Before you begin, you should have created the user in the Kill Bill system by following the steps in the <<includes/users.adoc#_add_a_user,"Add a User">> section.

. Click on your username and tenant name in the upper right corner:
+
image::Users-SelectTenantName.png[width=650,align="center"]
+
Kaui displays the Tenant Configuration page.
+
. To the right of *Allowed Users*, click the plus icon ( image:i_PlusGreen.png[] ).
+
image::UserTenantScreen2.png[width=850,align="center"]
+
Kaui displays the Add Allowed User pop-up.
+
image::AddAllowedUser.png[width=350,align="center"]
. Type the user name into the *User name* field.
. Click the *Add* button.
+
Kaui displays the newly added user to the Allowed Users list for the tenant.

=== Remove a User from the Tenant

Perform the steps below to remove a user from the current tenant. Note that this does not delete the user from the Kill Bill system.

[WARNING]
*Warning:* Deleting the `admin` user for a tenant means will remove administrative access to the tenant.

. Click on your username and tenant name in the upper right corner:
+
image::Users-SelectTenantName.png[width=650,align="center"]
+
Kaui displays the Tenant Configuration page.
+
. In the *Allowed Users* section, click the black *X* to the right of the user to remove:
+
image::UserTenantScreen3.png[width=850,align="center"]
+
. Click *OK* to confirm the deletion.

=== Catalog Show Tab

This section explains how to use the Catalog Show tab to create and manage catalogs:

[cols="1,1"]
[frame=none]
[grid=none]
|===

a| * <<View Catalog Products and Plans,View catalog products and plans>>
* <<Create a Simple Catalog,Create a simple catalog>>
* <<Upload an XML Catalog,Upload an XML catalog>>

a| * <<View the Catalog as XML,View the catalog as XML>>
* <<Delete a Catalog,Delete a catalog>>
* <<Download the Catalog,Download the catalog>>

|===

On this tab, you can also <<Add a Currency to a Plan,add a currency to a plan>>.

[NOTE]
*Note:* You cannot edit a raw XML catalog in Kaui.

==== Additional Catalog Resources

* https://killbill.github.io/slate/#catalog[Catalog API]
* https://docs.killbill.io/latest/userguide_subscription.html#components-catalog["Catalog"] section in _Subscription Guide_

==== View Catalog Products and Plans

You can view the current catalog's products and plans on the Catalog Show tab located at the bottom of the Tenant Configuration page.

To get there:

. Click on your username and tenant name in the upper right corner:
+
image::Users-SelectTenantName.png[width=650,align="center"]
+
Kaui displays the Tenant Configuration page.
+
. Scroll down until you see the Catalog Show tab:
+
image::Catalog-Tabs-ShowCat.png[width=850,align="center"]

==== Create a Simple Catalog

. <<View Catalog Products and Plans,Go to the Catalog Show tab>> on the Tenant Configuration page.
+
image::Catalog-Tabs-ShowCat.png[width=850,align="center"]
+
. Click the plus sign ( image:i_PlusGreen.png[] ) next to *Existing Plans*.
+
Kaui opens the Catalog Configuration screen:
+
image::CatalogConfiguration.png[width=450,align="center"]
+
. Fill in the fields. For field descriptions, see <<Catalog Configuration Field Descriptions>>.
. Click the *Save* button.

==== Catalog Configuration Field Descriptions

For additional field information, see the https://killbill.github.io/slate/#catalog[Catalog API].

[cols="1,3"]
|===
^|Field ^|Description

| Product Category
a| Define whether this product is of the `BASE`, `ADDON`, or `STANDALONE` category:

* Base products can have one or more addons.

* Add-on products can be bundled with a base product.

* Standalone products cannot have any add-ons.

| Product Name
| The name assigned to the product you are selling.

| Plan Name
| The name of the plan, which defines how the product will be sold (for example, a monthly subscription or a one-time purchase).

| Amount
| The price of the plan to be paid every billing period.

| Currency
| The currency this plan uses. If you need to add more currencies, you can do so by <<Add a Currency to a Plan,adding a currency to a plan>>.

| Billing Period
| The period for which the customer is billed.

| Trial Length
| Along with a unit of time (*Trial Time Unit* below), defines the length of the trial.

| Trial Time Unit
| Along with the *Trial Length* number above, specifies the time interval for the trial.
|===

==== Add a Currency to a Plan

. <<View Catalog Products and Plans,Go to the Catalog Show tab>> on the Tenant Configuration page.
+
image::Catalog-Tabs-ShowCat.png[width=850,align="center"]
+
. On the row of the plan for which you want to add a currency, click *+ currency* on the far right.
+
Kaui displays the Add Plan Currency screen:
+
image::Catalog-AddPlanCurrency.png[width=450,align="center"]
. Fill in the fields:
+
* *Plan ID*—By default, Kaui fills in this field based on the plan you selected, but you can change it to a different plan ID.
* *Amount*—The cost of the plan in the new currency you're adding.
* *Currency*—The currency you are adding.
+
. Click the *Save* button. Kaui displays the new currency on the Catalog Show tab.

==== Upload an XML Catalog

If you are replacing a catalog with a newer version, ensure that `<catalogName>` in the XML file is the same as the existing catalog. The catalog filename does not need to be the same.

[NOTE]
*Note:* To ensure a successful catalog file upload, check its validity with the https://cloud.killbill.io/tools/catalog[Kill Bill catalog validation tool].

To upload an XML catalog in Kaui:

. <<View Catalog Products and Plans,Go to the Catalog Show tab>> on the Tenant Configuration page.
+
image::Catalog-Tabs-ShowCat.png[width=850,align="center"]
+
. Click the plus sign ( image:i_PlusGreen.png[] ) next to *Existing Plans*.
+
Kaui opens the Catalog Configuration screen:
+
image::CatalogConfiguration.png[width=450,align="center"]
+
. Click on *Enable Advanced Configuration (Upload XML)*.
+
Kaui displays an upload screen:
+
image::Catalog-AdvancedConfigUpload.png[width=450,align="center"]
+
. Click the *Choose File* button, locate the XML file, and select it.
+
Once you have selected the file, Kaui displays the filename next to the *Choose File* button.
+
image::Catalog-AdvancedConfigUpload-File.png[width=450,align="center"]
+
. Click the *Upload* button.
+
If the upload is successful, Kaui displays a confirmation message along with a list of plans on the Catalog Show tab:
+
image::Catalog-UploadSuccess.png[width=950,align="center"]

[NOTE]
*Note:* If you receive an "Invalid catalog for tenant" error, run the catalog through the https://cloud.killbill.io/tools/catalog[Kill Bill catalog validation tool] (if you haven't already). You can also <<Delete a Catalog,delete the existing catalog>> and retry the upload steps.

==== View the Catalog as XML

. <<View Catalog Products and Plans,Go to the Catalog Show tab>> on the Tenant Configuration page.
+
image::Catalog-Tabs-ShowCat.png[width=850,align="center"]
+
. Click *Enable XML View*.
+
Kaui displays the a list of catalog versions:
+
image::Catalog-ListOfVersions.png[width=850,align="center"]
+
. Click *view xml*. Kaui displays the raw XML (uneditable in this view).
+
image::Catalog-RawXML.png[width=650,align="center"]
+
. To return to Kaui, click the Back arrow button of your browser.

==== Delete a Catalog

. <<View Catalog Products and Plans,Go to the Catalog Show tab>> on the Tenant Configuration page.
+
image::Catalog-Tabs-ShowCat.png[width=850,align="center"]
+
. Click the red X ( image:i_RedX.png[] ) to the left of *Enable XML View*.
+
Kaui removes the plans from the Catalog Show tab and displays a successful deletion message.

==== Download the Catalog

The steps below explain how to download the current Kill Bill catalog in XML format.

. <<View Catalog Products and Plans,Go to the Catalog Show tab>> on the Tenant Configuration page.
+
image::Catalog-Tabs-ShowCat.png[width=850,align="center"]
+
. Click the down arrow ( image:i_GreenDownloadArrow.png[] ).
+
image::Catalog-Download.png[width=250,align="center"]
+
Kaui downloads the `.xml` file to your default download folder on your local drive.

=== Overdue Show

On this tab, you can configure overdue states and actions for this tenant. The interface provides a subset of the full overdue configuration settings. For more information, see the https://docs.killbill.io/latest/overdue.html[_Overdue System Guide_].

This tab allows you to specify overdue states and actions for the tenant.
When you configure states/actions on this tab, you

[cols="1,1"]
[frame=none]
[grid=none]
|===

a| * <<View Overdue Configuration,View overdue configuration>>
* <<Define Overdue Configuration,Define overdue configuration>>
* <<Upload an XML Overdue Configuration File,Upload an XML overdue configuration file>>

a| * <<View Overdue Configuration as XML,View overdue configuration as XML>>
* <<Delete Overdue Configuration,Delete overdue configuration>>

|===

[NOTE]
*Note 1:* You cannot edit the overdue configuration XML file in Kaui.

[NOTE]
*Note 2:* You can also configure overdue actions for the _global_ Kill Bill system (as opposed to configuring a tenant). For more information, see the https://docs.killbill.io/latest/overdue.html[_Overdue System_] documentation.

==== Additional Overdue Resources

* https://docs.killbill.io/latest/userguide_subscription.html#components-overdue["Overdue"] section in the _Subscription Guide_.
* https://docs.killbill.io/latest/overdue.html[_Overdue System Guide_]

==== View Overdue Configuration

If any overdue (dunning) actions are configured, you can see them on the Overdue Show tab at the bottom of the Tenant Configuration page.

To get there:

. Click on your username and tenant name in the upper right corner:
+
image::Users-SelectTenantName.png[width=650,align="center"]
+
Kaui displays the Tenant Configuration page.
+
. Scroll down and click on the Overdue Show tab:
+
image::OverdueTab.png[width=850,align="center"]

==== Define Overdue Configuration

You can repeat the steps below as many times as necessary to create multiple overdue states/actions.

To edit an existing overdue state/action, ... ***

. <<View Overdue Actions,Go to the Overview Show tab>> on the Tenant Configuration page.
+
image::OverdueTab.png[width=850,align="center"]
+
. Click the plus sign ( image:i_PlusGreen.png[] ) next to *Existing Overdue Config*.
+
Kaui opens the Overdue Configuration screen:
+
image::OverdueConfig-Empty.png[width=850,align="center"]
+
. Click *+ New Overdue States*. Kaui opens the fields for editing:
+
image::OverdueConfig-BlankFields.png[width=850,align="center"]
+
. Fill in the fields for the current row. For field information, see the <<Overdue Configuration Field Descriptions>> table.
+
. To add another overdue configuration row, click "new overdue states."
+
image::Overdue-Select-NewOverdueState.png[width=450,align="center"]
+
. When you are done adding configuration rows, click the *Save* button. Kaui displays the new row(s) on the Overdue Show tab:
+
NEED A SCREENSHOT

==== Overdue Configuration Field Descriptions

[cols="1,3"]
|===
^|Field ^|Description

| Name
| The name assigned to the overdue state.

| External Message
| Message text that other plugins, when listening for overdue events, can retrieve and display to the user. (_Optional_)

| Block Subscription Changes
| If set to `true`, the customer can make plan changes to the subscription in this overdue state. If set to `false`, the customer cannot make changes.

| Subscription Cancellation
a| Select the option that describes how Kill Bill cancels the subscription in this overdue state:

* `NONE`: ???

* `POLICY_NONE`: ???

* `POLICY_IMMEDIATE_POLICY`: Cancels the subscription immediately and applies a partial credit to the
account based on how much of the service has been consumed.

* `END_OF_TERM`: Cancels the subscription at the end of the billing period with no refund to
the customer (i.e., no proration).

| Days Since Earliest Unpaid Invoice
| Specifies that the overdue action for this state occurs when _X_ days have passed since the last unpaid invoice.

| Tag Inclusion
| Specifies that the overdue action will occur if the account is tagged with any of the selected control tags. To disregard tag inclusion for this overdue state, eave as the default `NONE` setting.

* `AUTO_PAY_OFF`
* `AUTO_INVOICING_OFF`
* `OVERDUE_ENFORCEMENT_OFF`
* `MANUAL_PAY`
* `TEST`
* `PARTNER`

For a description of system tags, see the https://docs.killbill.io/latest/userguide_subscription.html#components-tag["Tags"] section of the _Subscription Guide_.

| Tag Exclusion
| Specifies that the overdue action will _not_ occur if the account is tagged with any of the selected control tags. See tags information above.

| Number of Unpaid Invoices
| Specifies that the overdue action will occur if the number of unpaid invoices equals or exceeds the specified value.

| Total Unpaid Invoice Balance
| Specifies that the overdue action will occur if the total unpaid invoice balance equals or exceeds the specified value.

|===

==== Upload an XML Overdue Configuration File

==== View Overdue Configuration as XML





=== Invoice Template


=== Invoice Translation


=== Catalog Translation


=== Plugin Config
